# MedROI: Codec-Agnostic ROI-Centric Compression for Medical Images

[![Paper](https://img.shields.io/badge/Paper-ICPR%202026-blue)]
[![License](https://img.shields.io/badge/License-MIT-green)](LICENSE)

> **MedROI: Codec-Agnostic Region of Interest-Centric Compression for Medical Images**  
> Jiwon Kim, Ikbeom Jang  
> *Under review at ICPR 2026*

MedROI is a plug-and-play ROI-centric compression framework that removes non-diagnostic background regions before compression, achieving significant storage savings across diverse medical imaging codecs without architectural modifications.

## Key Features

- **Codec-Agnostic**: Compatible with conventional codecs (JPEG2000, HEIF) and neural compressors (TCM, BCM-Net, SirenMRI)
- **Lightweight Metadata**: Only 54 bytes required for spatial reconstruction
- **Significant Gains**: Up to 81.3:1 compression ratio with TCM while maintaining clinical quality (PSNR ≥30 dB)
- **Efficient Processing**: Reduces compression/decompression time by eliminating background voxels

## Scope & What’s Included

This repository provides:
- MedROI ROI extraction + 54-byte metadata generation
- ROI cropping / restoration utilities for NIfTI volumes
- Experiment wrappers to run external codecs in a unified pipeline

This repository does NOT redistribute external compression models/codecs.
To reproduce codec-specific results, please install each codec from its official repository
and run our wrapper scripts.

## ROI Metadata Format (54 bytes)

MedROI stores a fixed-length metadata record per volume:
- Bounding box (xmin, xmax, ymin, ymax, zmin, zmax): int16 (12 bytes)
- Original shape (W, H, D): int16 (6 bytes)
- Affine matrix (3×3 rotation-scaling): float32 (36 bytes)

Total: 54 bytes

## Supported Codecs

### 2D Compression
- **Conventional**: JPEG2000-2D, HEIF
- **Neural**: LIC_TCM, TCM+AuxT, BCM-Net

### 3D Compression
- **Conventional**: JPEG2000-3D
- **Neural**: SirenMRI

## Installation
```bash
git clone https://github.com/labhai/MedROI.git
cd MedROI
```

### Prerequisites
- Python 3.12.3 (or compatible)
- PyTorch, nibabel, numpy, pillow, scikit-image

Each compression method requires its own dependencies. Please refer to the official repositories:
- [LIC_TCM](https://github.com/jmliu206/LIC_TCM)
- [TCM+AuxT](https://github.com/qingshi9974/AuxT)
- [BCM-Net](https://github.com/LiuXiangrui/BCM-Net)
- [SirenMRI](https://github.com/palombom/SirenMRI)

## Unified Inputs (Common Interface)

All experiment wrappers assume the following common inputs:

- `--original_dir`: directory of original NIfTI volumes (`*.nii` or `*.nii.gz`)
- `--cropped_dir`: directory of MedROI-cropped volumes (generated by MedROI)
- `--bbox_csv`: CSV file containing ROI bounding boxes per volume
- `--output`: output directory (codec-specific subfolders will be created)

## Quick Start

### ROI Extraction
```bash
# Generate bounding box metadata from NIfTI volumes
python src/bbox/bbox_nifti.py \
    --input_dir ./data/nifti \
    --output ./bbox_info.csv
```

### Compression Examples

**2D Neural Compression (TCM)**
```bash
python external/2D_Models/LIC_TCM/eval_tcm.py \
    --checkpoint ./models/tcm.pth.tar \
    --cropped_dir ./data/cropped_volumes \
    --original_dir ./data/original_nifti \
    --bbox_csv ./bbox_info.csv \
    --output ./results \
    --real_mode
```

**3D Compression (JPEG2000)**
```bash
python external/3D_Models/jpeg_3d.py \
    --cropped_dir ./data/cropped_volumes \
    --original_dir ./data/nifti \
    --output ./results \
    --bbox_file ./bbox_info.csv
```

**Conventional 2D (HEIF)**
```bash
python external/HEIF.py \
    --mode roi \
    --input_dir ./data/cropped_volumes \
    --output ./results \
    --bbox_csv ./bbox_info.csv \
    --original_dir ./data/original_nifti
```

### Full Volume Mode (without ROI)
```bash
python external/2D_Models/LIC_TCM/eval_tcm.py \
    --checkpoint ./models/tcm.pth.tar \
    --use_original_only \
    --original_dir ./data/original_nifti \
    --output ./results \
    --real_mode
```

## Project Structure
```
MedROI/
├── configs/              # Configuration files
├── external/
│   ├── 2D_Models/       # 2D neural compression methods
│   │   ├── AuxT/
│   │   ├── BCM-Net/
│   │   ├── LIC_TCM/
│   │   ├── HEIF.py       
│   │   └── jpeg.py          # JPEG2000-2D compression   
│   └── 3D_Models/       # 3D compression methods
│       ├── SirenMRI/
│       └── jpeg_3d.py
├── scripts/             # Utility scripts
├── src/
│   ├── bbox/           # ROI extraction modules
│   │   ├── bbox_dicom.py
│   │   └── bbox_nifti.py
│   └── models/         # Model utilities
└── README.md
```

## Dataset

The paper uses the ADNI (Alzheimer's Disease Neuroimaging Initiative) dataset with 200 T1-weighted brain MRI volumes. For dataset access, please visit [ADNI website](http://adni.loni.usc.edu/).

A pilot study on INbreast mammography dataset is also reported in the paper.

## Citation

If you find this work useful, please cite:
```bibtex
@inproceedings{kim2026medroi,
  title={MedROI: Codec-Agnostic Region of Interest-Centric Compression for Medical Images},
  author={Kim, Jiwon and Jang, Ikbeom},
  booktitle={International Conference on Pattern Recognition (ICPR)},
  year={2026}
}
```

## Acknowledgments

This work builds upon several excellent compression methods:
- **LIC_TCM**: [Learned Image Compression With Mixed Transformer-CNN Architectures](https://arxiv.org/abs/2303.14978) (CVPR 2023)
- **TCM+AuxT**: [On Disentangled Training for Nonlinear Transform in Learned Image Compression](https://arxiv.org/abs/2501.13751) (ICLR 2025)
- **BCM-Net**: [Bilateral Context Modeling for Residual Coding in Lossless 3D Medical Image Compression](https://ieeexplore.ieee.org/document/10478821) (TIP 2024)
- **SirenMRI**: [Lossy Compression of Multidimensional Medical Images Using Sinusoidal Activation Networks](https://arxiv.org/abs/2208.01602)

## Contact

- **Jiwon Kim**: harryy5981@hufs.ac.kr
- **Ikbeom Jang** (Corresponding): ijang@hufs.ac.kr

---

**Hankuk University of Foreign Studies**  
Division of Computer Engineering | Department of Computer Science and Engineering